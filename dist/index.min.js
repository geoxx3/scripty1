"use strict";var express=require("express"),ejsMate=require("ejs-mate"),mongoose=require("mongoose"),session=require("express-session"),flash=require("connect-flash"),path=require("path"),dotenv=require("dotenv"),passport=require("passport"),ExpressError=require("./utils/ExpressError"),LocalStrategy=require("passport-local"),User=require("./models/user"),helmet=require("helmet"),_require=require("./middleware"),isLoggedIn=_require.isLoggedIn,userRoutes=require("./routes/users"),MongoDBStore=require("connect-mongo")(session);dotenv.config({path:"./config.env"});var DB=process.env.DATABASE||"mongodb://localhost:27017/auth";mongoose.connect(DB,{useNewUrlParser:!0,useUnifiedTopology:!0,useCreateIndex:!0,useFindAndModify:!1}).then(function(){return console.log("DB connection successful!")});var db=mongoose.connection;db.on("error",console.error.bind(console,"connection error:")),db.once("open",function(){console.log("Database connected")});var app=express();app.engine("ejs",ejsMate),app.set("view engine","ejs"),app.set("views",path.join(__dirname,"/views")),app.use(express.urlencoded({extended:!0})),app.use(express.static(path.join(__dirname,"public")));var secret=process.env.SECRET||"thisshouldbeabettersecret!",store=new MongoDBStore({url:DB,secret:secret,touchafter:86400});store.on("error",function(e){console.log("SESSION STORE ERROR",e)});var sessionConfig={store:store,name:"name",secret:secret,resave:!1,saveUninitialized:!0,cookie:{httpOnly:!0,expires:Date.now()+6048e5,maxAge:6048e5}};app.use(session(sessionConfig)),app.use(flash()),app.use(passport.initialize()),app.use(passport.session()),passport.use(new LocalStrategy(User.authenticate())),passport.serializeUser(User.serializeUser()),passport.deserializeUser(User.deserializeUser()),app.use(function(e,s,r){s.locals.currentUser=e.user,s.locals.success=e.flash("success"),s.locals.error=e.flash("error"),r()}),app.use("/",userRoutes),app.get("/",function(e,s){s.render("index")}),app.get("/pricing",function(e,s){s.render("pricing")}),app.get("/contact",function(e,s){s.render("contact")}),app.get("/user",isLoggedIn,function(e,s){s.render("user")}),app.get("/strl",function(e,s){s.render("strl")}),app.get("/strs",function(e,s){s.render("strs")}),app.all("*",function(e,s,r){r(new ExpressError("Page Not Found",404))}),app.listen(5e3,function(){console.log("listening at 5000")});
//# sourceMappingURL=index.min.js.map
